//@version=6
indicator('Highlight Time', overlay = true, max_lines_count = 500)


instrument = syminfo.ticker
// Only on last bar & is newly generated bar
// So that the log is not clogged
// Ok nvm, when i switch to higher timeframe, it has no log, or waiting for one i dk
//if barstate.islast and barstate.isnew

// This one will TRUE every tick.
if barstate.islast
    log.info(instrument + " " + timeframe.period)


daylight_saving_EU = input.bool(false, title="Daylight Saving Europe")
daylight_saving_US = input.bool(false, title="Daylight Saving United State")


// -----------
// Trading Time
// -----------

// from 8am to 12am, monday to sunday
var my_session      = "0800-2400:1234567"
var asia_session    = "0700-1000:1234567"
var germany_session = ""
var us_session      = ""

if daylight_saving_EU
    germany_session := "1500-1630:1234567"
else
    germany_session := "1600-1730:1234567"

if daylight_saving_US
    us_session := "2130-2300:1234567"
else
    us_session := "2230-2400:1234567"

// ----------
// PLotting for My session
// I want my session to be
// able to show open time
// based on stock
// ----------
if instrument == "AUS200" or instrument == "JP225YJPY" or instrument == "HK50" or instrument == "CHINA50"
    // AUS, usually after 2pm, the spread will be big ady
    my_session := "0800-1300:1234567"

if instrument == "UK100" or instrument == "GER40"
    // I only wanna show the 1st half of market opening Day
    // Usually 2nd half got 2 sessions running together and... probably not a good time for trade?
    // Hence, Germany open is 4pm-12am (Daylight saving), but i want 4pm-8pm only
    // Germany, possible to put before 4pm? Like Pre-London session, 2pm etc.
    // Well, not really, 2pm the spread is 6, still big 99 until niama also cannot recognize
    // For non-daylight saving time, market open is 4pm, but 3pm the spread will be reduced to 2
    if daylight_saving_EU
        my_session := "1500-2000:1234567"
    else
        my_session := "1500-2100:1234567"

if instrument == "NAS100" or instrument == "US30" or instrument == "SP500"
    // originally, until 6am, but i wont be trading until 6am..
    if daylight_saving_US
        my_session := "2100-0100:1234567"
    else
        my_session := "2200-0100:1234567"

// Check if the current time is within the specified range
inTimeRange = math.sign(nz(time(timeframe.period, my_session, "UTC+8")))

// Plot the background color if the current time is within the range
bgcolor(inTimeRange > 0 ? color.new(color.blue, 90) : na, title = "My session")


// -----------
// PLotting Asia open
// -----------
asia_inTimeRange = math.sign(nz(time(timeframe.period, asia_session, "UTC+8")))
bgcolor(asia_inTimeRange > 0 ? color.new(color.red, 90) : na, title = "Asia session", display = display.none)

// -----------
// Plotting Germany open
// -----------
germany_inTimeRange = math.sign(nz(time(timeframe.period, germany_session, "UTC+8")))
bgcolor(germany_inTimeRange > 0 ? color.new(color.green, 90) : na, title = "Germany session", display = display.none)

// -----------
// Plotting US open
// -----------
us_inTimeRange = math.sign(nz(time(timeframe.period, us_session, "UTC+8")))
bgcolor(us_inTimeRange > 0 ? color.new(color.yellow, 90) : na, title = "US session", display = display.none)



// -----------
// Draw session break
// It will not draw on H4 and above time
// -----------
var me_sessionBreak = 0
var draw_session_break = true
sessionBreak = time_tradingday

var four_hour = "240"
var daily = "1D"
var monthly = "1M"
var weekly = "1W"

if timeframe.period == four_hour
    draw_session_break := false
if timeframe.period == daily
    draw_session_break := false
if timeframe.period == monthly 
    draw_session_break := false
if timeframe.period == weekly
    draw_session_break := false

if draw_session_break
    if(sessionBreak!=me_sessionBreak)
        me_sessionBreak:=sessionBreak
        // label.new(x=bar_index, y=high, text="New Day")
        // no need bah i guess..
        // line.new(bar_index, low, bar_index, high, style = line.style_dashed)



// ---------
// Draw ATH
// I realize that, if M5, the maximum candle is 5k
// Those ATH that is way before 5k candle, is missed
// Hence, the best way to draw ATH, is draw based on 12 Months timeframe
// ---------

// Draw ATH on Yearly timeframe
// Request Highest for Yearly chart
var ATH = request.security(syminfo.tickerid, "12M", high)
ATH := math.max(high, ATH)

// But then i realize, if you on weekly chart, the value will be "NA"
// Not sure what happened but i guess, can put check if "NA", then draw 
// ATH based on current timeframe
if na(ATH)
    log.info("ATH is NA")
    ATH := high
    ATH := math.max(high, ATH)

// Plot the ATH on the M5 chart
plot_ATH = plot(ATH, color = color.new(color.yellow, 50), title = "ATH Plot", display = display.pane)
plot_price_low = plot(low, display = display.none, title = "Price Low Plot")
fill(plot_price_low, plot_ATH, color = color.new(color.yellow, 95), title = "ATH Fill")

